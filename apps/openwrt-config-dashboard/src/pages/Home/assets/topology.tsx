import { Icon } from 'mobsya-theme';
import React from 'react';
import { useTranslation } from 'react-i18next';
import styled from 'styled-components';
import { TopologyData } from '../types';

// Estilos para el contenedor SVG
const SVGContainer = styled.div`
  width: 100%;
  height: 100%;
  margin: auto;

  svg {
    width: 100%;
    height: 100%;
  }
`;

// Componentes para los círculos
const Circle = styled.circle`
  fill: white;
  stroke: ${(props) => props.color || '#452AB6'};
  stroke-width: 1.5;
`;

const CircleInternet = styled.circle`
  fill: white;
  stroke: ${(props) => props.color || '#008800'};
  stroke-width: 1.5;
`;

const SVGNumberText = styled.text`
  fill: #452ab6;
  font-size: 12px;
  font-family: 'Arial', sans-serif; // Puedes cambiar esto a la familia de fuentes que prefieras
`;

const SVGText = styled.text<{ color?: string }>`
  fill: black;
  font-size: 8px;
  font-family: 'Arial', sans-serif; // Puedes cambiar esto a la familia de fuentes que prefieras
  fill: ${(props) => props.color || 'black'};
`;

// Icono de Internet
const InternetIcon = ({ x, y, isConnected }: { x: number; y: number; isConnected: boolean }) => (
  <g style={{ stroke: '#292D32', scale: '0.09', transform: `translate(${x * 7.7}px,${y * 9.2}px)` }}>
    <path
      fill={isConnected ? '#008800' : '#6b6b6b'}
      d="M169.516,0C76.044,0,0,76.045,0,169.517c0,93.471,76.044,169.516,169.516,169.516s169.516-76.044,169.516-169.516
			S262.989,0,169.516,0z M143.367,17.224c-13.76,11.78-26.933,26.445-37.516,42.056c-4.766,7.031-9.051,14.291-12.856,21.737H42.93
			C66.133,47.926,101.962,24.312,143.367,17.224z M162.016,244.596h-59.371c-8.934-19.363-15.104-41.7-16.14-66.79h75.511V244.596z
			 M33.628,96.017h52.462c-8.754,21.293-13.708,43.833-14.594,66.79H15.156C16.19,138.717,22.756,116.037,33.628,96.017z
			 M15.224,177.807H71.49c0.863,23.317,5.768,45.651,14.643,66.79H34.51C23.359,224.625,16.506,201.944,15.224,177.807z
			 M44.05,259.596h49.157c3.749,7.149,7.968,14.15,12.671,20.988c12.478,18.143,25.89,31.638,37.218,41.179
			C102.469,314.734,67.229,291.787,44.05,259.596z M162.016,317.587c-16.754-12.269-36.477-31.838-51.588-57.991h51.588V317.587z
			 M162.016,162.807H86.505c0.934-23.32,6.239-45.666,15.834-66.79h59.678V162.807z M162.016,81.017H109.99
			c2.556-4.502,5.31-8.944,8.276-13.32c15.442-22.78,32.369-37.697,43.75-46.15V81.017z M323.878,162.807h-56.341
			c-0.886-22.957-5.84-45.497-14.594-66.79h52.461C316.276,116.037,322.844,138.717,323.878,162.807z M296.104,81.017h-50.064
			c-3.805-7.446-8.091-14.706-12.856-21.737c-10.583-15.612-23.76-30.273-37.521-42.057
			C237.068,24.311,272.898,47.925,296.104,81.017z M177.016,21.546c11.381,8.453,28.308,23.37,43.75,46.15
			c2.966,4.376,5.72,8.818,8.276,13.32h-52.026V21.546z M177.016,96.017h59.678c9.595,21.124,14.9,43.47,15.834,66.79h-75.512
			V96.017z M177.016,177.807L177.016,177.807h75.512c-1.035,25.09-7.206,47.427-16.14,66.79h-59.372V177.807z M177.016,259.596
			h51.588c-15.111,26.152-34.834,45.722-51.588,57.991V259.596z M195.94,321.763c11.327-9.54,24.738-23.038,37.215-41.178
			c4.703-6.838,8.922-13.839,12.671-20.988h49.157C271.805,291.786,236.566,314.733,195.94,321.763z M304.523,244.596h-51.622
			c8.875-21.139,13.78-43.472,14.643-66.79h56.265C322.526,201.944,315.674,224.625,304.523,244.596z"
    />
  </g>
);

// Icono del router mango
const MangoIcon = ({ x, y }: { x: number; y: number }) => (
  <g
    id="Layer_1"
    data-name="Layer 1"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 200 250"
    style={{ scale: '0.2', transform: `translate(${x * 4.5}px,${y * 3.6}px)` }}
  >
    <path
      fill="#452AB6"
      d="M169.47,159.33c6.5-1.72,7.84-6.9,7.6-9.7.32-5.4,1.87-32.15,1.87-35.5,0-3.65-3.21-6-5.1-6.83l-4-2.2c-.27-.13-31.84-14.48-42-19.32-9.69-4.64-15.62-4.8-16.69-4.79-.5,0-2.27-.12-5.15-.12a199.26,199.26,0,0,0-32.13,2.89c-23.94,4-37.37,8.81-45.38,12.08-.61.25-6,2.53-6.93,6.12a29.9,29.9,0,0,0-.33,4.84c0,.23-.13,24-.24,30.25-.11,6.56,3.71,8.89,4.88,9.44l42.81,25.57a26.1,26.1,0,0,0,12.31,5.07,48,48,0,0,0,6.65.46,36.05,36.05,0,0,0,6.39-.49C94.76,176.94,162.37,161.22,169.47,159.33Zm-146-56.25a4.71,4.71,0,0,1,.1-.72c.31-1.17,2.57-2.94,5-4,8-3.27,21.42-8.08,45.46-12.09a201.34,201.34,0,0,1,32.27-2.89c3.12,0,4.85.11,4.92.12h.13c.12,0,5.74-.18,15.56,4.52,10.39,5,42.36,19.52,42.69,19.66l4.12,2.28h0s2.91,1.29,3.16,3.54l0,.27-.21.18c-1.71,1.39-5.77,3.06-15.43,3.15-22.46.19-43.49,7.81-58.85,13.38l-3.69,1.33A36.43,36.43,0,0,1,86.44,134,38.4,38.4,0,0,1,67.5,128.9l-2.37-1.37c-6.51-3.8-26.34-15.35-41.43-24l-.28-.15Zm64,72a46.48,46.48,0,0,1-6.27-.43,22.88,22.88,0,0,1-10.87-4.45l-.15-.13L26.06,143.71c-.1-.05-3.07-1.41-3-6.46.11-6.45.24-30.59.24-30.83,0-.42,0-.88,0-1.34l0-.84.73.42c15.15,8.67,34.52,20,40.88,23.66l2.13,1.24a39.11,39.11,0,0,0,19.33,5.23A37.12,37.12,0,0,0,99,132.58l3.68-1.33C118,125.71,139,118.11,161.3,117.92c6.88-.06,11.86-.94,14.82-2.61l.79-.44,0,.89c-.31,7.9-1.84,33.92-1.85,34.14v.19l0,.1c0,.2.51,4.87-5.21,6.38-5.9,1.57-54.54,12.92-75.18,17.72l-1.35.32A35,35,0,0,1,87.47,175Z"
    />
    <ellipse className="st1" cx="116.14" cy="118.73" rx="2.09" ry="1.12" />
    <ellipse className="st2" cx="129.35" cy="115.2" rx="2.09" ry="1.12" />
    <ellipse className="st3" cx="142.57" cy="112.56" rx="2.09" ry="1.12" />
    <path
      fill="#F57715"
      d="M43.56,136.83a3.24,3.24,0,0,0-2.14,0c-1.38.23-2.39,2.32-2.39,5,0,2.89,1.14,5.07,2.65,5.07h.08a3.81,3.81,0,0,0,.78.08,5.67,5.67,0,0,0,1-.08c1.49-.23,2.57-2.36,2.57-5.06C46.08,139.33,45.05,137.25,43.56,136.83Zm-.12,5c0,2.47-.93,4.19-1.76,4.19s-1.76-1.72-1.76-4.19.92-4.19,1.76-4.19S43.44,139.41,43.44,141.88Zm-.07,4.19-.18,0a8.4,8.4,0,0,0,0-8.45l.15,0c.93.27,1.88,1.79,1.88,4.2S44.27,145.93,43.37,146.07Z"
    />
    <path
      fill="#F57715"
      d="M60.05,147.36l-7-4.13a2.84,2.84,0,0,0-1.58-1.08,3.28,3.28,0,0,0-2.14.17c-1.35.33-2.21,2.49-2,5.2.21,2.88,1.51,5,3,4.86h0L59,157.5a2.15,2.15,0,0,0,1.26.33,1.85,1.85,0,0,0,.74-.22c.94-.5,1.57-1.82,1.68-3.54C62.87,151.29,61.71,148.34,60.05,147.36Zm-10.38-4.21c.83-.06,1.89,1.59,2.07,4s-.62,4.24-1.46,4.3-1.88-1.58-2.06-4S48.84,143.21,49.67,143.15Zm1.64-.13c.95.19,2,1.65,2.18,4s-.63,4.11-1.51,4.31l-.19,0a8.38,8.38,0,0,0-.64-8.42Zm10.52,11a3.41,3.41,0,0,1-1.22,2.81,1.08,1.08,0,0,1-1.13-.08l-7.54-4.47.23,0c1.48-.34,2.4-2.54,2.2-5.24a8.15,8.15,0,0,0-.49-2.26l5.72,3.38C61,148.92,62,151.62,61.83,154Z"
    />
    <path
      fill="#F57715"
      d="M32.29,115.07h0l-.26-.14h0l-2.74-1.5h0l-2.76-1.52V138.1l8.2,4.49V116.4Zm-3.74,21.11v0l-.51.3V114.33l.51.28Zm4.67,3.74-4.66-2.56.5-.29,4.16,2.27Zm0-2.91-2.07-1,.13-.15,1.94,1Zm0-3.34-.93-.5V116.66l.94.51Z"
    />
    <path
      fill="#F57715"
      d="M67.92,141.12c0,.26-.08.52-.11.79,0,.12,0,.24,0,.36a6.77,6.77,0,0,0,0,1.19,8.74,8.74,0,0,0,.36,1.79c.25-.61,1.52-1,1.52-1A8.61,8.61,0,0,0,68,141Z"
    />
    <path
      fill="#F57715"
      d="M74.68,143.89a7.32,7.32,0,0,0-2.77-5,3.32,3.32,0,0,0-2.68-.52h0a2,2,0,0,0-.33.13c-2.25.84-3.54,4.06-3,7.5a7.3,7.3,0,0,0,2.77,5,3.47,3.47,0,0,0,1.93.62,3.2,3.2,0,0,0,.75-.09,4.24,4.24,0,0,0,2.64-2.4A9,9,0,0,0,74.68,143.89ZM72.28,146a4.74,4.74,0,0,1-1.63-.33.2.2,0,0,0-.13,0,3.07,3.07,0,0,0-1.06,2.1,6.11,6.11,0,0,0,.68.67l.08.05a4.18,4.18,0,0,0,.74.47h0a3.88,3.88,0,0,0,.79.27h.15a2.76,2.76,0,0,0,.49.07h.28a2.87,2.87,0,0,1-1.62,1.26,2.33,2.33,0,0,1-1.88-.38,6.35,6.35,0,0,1-2.34-4.33,7.51,7.51,0,0,1,.87-5.07,4.09,4.09,0,0,0-.67-.51c.94-.18,3.07-.39,3.61,1.14a7.8,7.8,0,0,1,0,2.29,2.63,2.63,0,0,0,3.09-1.49C73.88,143.52,74.29,145.41,72.28,146Z"
    />
  </g>
);

// Icono de thymio
const ThymioIcon = ({ x, y }: { x: number; y: number }) => (
  <g style={{ stroke: '#292D32', scale: '0.12', transform: `translate(${x * 8}px,${y * 7.3}px)` }}>
    <path
      strokeWidth="6"
      id="svg_1"
      fill="none"
      stroke="#452AB6"
      strokeLinejoin="bevel"
      strokeLinecap="round"
      d="m22.17674,73.25107l213.32362,0c4.108,0 7.33574,3.22773 7.33574,7.33575l0,72.77063c0,4.10802 -3.22774,7.33574 -7.33574,7.33574l-213.32362,0c-4.10802,0 -7.33574,-3.22772 -7.33574,-7.33574l0,-72.77063c0,-4.10802 3.22773,-7.33575 7.33574,-7.33575z"
    />
    <line
      id="svg_2"
      fill="none"
      stroke="#452AB6"
      strokeLinejoin="bevel"
      strokeLinecap="round"
      strokeWidth="6"
      y2="105.23493"
      x2="228.75147"
      y1="105.23493"
      x1="240.7821"
    />
    <line
      id="svg_3"
      fill="none"
      stroke="#452AB6"
      strokeLinejoin="bevel"
      strokeLinecap="round"
      strokeWidth="6"
      y2="105.23493"
      x2="193.41491"
      y1="105.23493"
      x1="216.30245"
    />
    <circle
      id="svg_4"
      fill="white"
      stroke="#452AB6"
      strokeLinejoin="bevel"
      strokeLinecap="round"
      strokeWidth="8"
      r="44.0145"
      cy="133.69764"
      cx="79.68903"
    />
    <path
      id="svg_5"
      fill="none"
      stroke="#452AB6"
      strokeLinejoin="bevel"
      strokeLinecap="round"
      strokeWidth="6"
      d="m188.2581,162.4538c1.17374,7.0423 -0.29341,7.0423 2.93433,9.09633c2.34744,1.46712 7.04231,4.40143 12.03061,4.108c4.10805,-0.29343 8.21605,-2.34744 10.27008,-3.81461c2.64085,-2.054 2.34743,-3.52115 2.64085,-9.38972"
    />
  </g>
);

// Icon of the device
const DeviceIcon = ({ x, y }: { x: number; y: number }) => (
  <g style={{ stroke: '#292D32', scale: '0.12', transform: `translate(${x * 8}px,${y * 4.5}px)` }}>
    <path
      stroke="null"
      fill="#452AB6"
      id="svg_3"
      d="m86.40093,144.96913l0,20.40541l-7.90057,0c-5.51219,0 -9.97396,3.72202 -9.97396,8.3098c0,4.58884 4.46177,8.30072 9.97396,8.30072l65.02238,0c5.51347,0 9.98418,-3.71188 9.98418,-8.30072c0,-4.58778 -4.4707,-8.3098 -9.98418,-8.3098l-7.89992,0l0,-20.40541l50.05568,0c10.24872,0 18.58247,-6.93512 18.58247,-15.46614l0,-84.35455c0,-8.52995 -8.33376,-15.46559 -18.58247,-15.46559l-149.33391,0c-10.24998,0 -18.58311,6.93564 -18.58311,15.46559l0,84.35455c0,8.53102 8.33314,15.46614 18.58311,15.46614l50.05634,0zm-48.68132,-98.6752l146.58389,0l0,82.0641l-146.58389,0l0,-82.0641z"
    />
    <rect stroke="null" id="svg_7" height="79.80943" width="47.45425" y="123.51286" x="6.2247" fill="#ffffff" />
    <path
      stroke="null"
      id="svg_2"
      fill="#452AB6"
      d="m47.31013,121.3672l-36.26402,0c-4.36759,0 -7.9083,3.54972 -7.9083,7.90883l0,68.68369c0,4.36758 3.54071,7.90935 7.9083,7.90935l36.26402,0c4.3591,0 7.90031,-3.54176 7.90031,-7.90935l0,-68.68369c0,-4.35911 -3.54121,-7.90883 -7.90031,-7.90883zm-0.40097,7.90883l0,61.22528l-35.51099,0l-0.35204,-60.82484l35.86303,-0.40044zm-21.68917,68.48c0,-2.16757 1.76608,-3.95067 3.95015,-3.95067c2.19205,0 3.95813,1.7831 3.95813,3.95067c0,2.18408 -1.76608,3.95866 -3.95813,3.95866c-2.18407,0 -3.95015,-1.77458 -3.95015,-3.95866z"
    />
    <rect stroke="null" id="svg_8" height="93.83" width="67.94586" y="100.86423" x="144.27344" fill="#ffffff" />
    <rect stroke="null" id="svg_9" height="0" width="1.07851" y="233.52045" x="112.99677" fill="#ffffff" />
    <path
      stroke="null"
      id="svg_4"
      fill="#452AB6"
      d="m135.69641,107.07234l0,90.62811c0,8.57141 6.97607,15.548 15.54695,15.548l60.63715,0c8.57091,0 15.54694,-6.97659 15.54694,-15.548l0,-90.62811c0,-8.57091 -6.97603,-15.54697 -15.54694,-15.54697l-60.63716,0c-8.57089,-0.00053 -15.54694,6.97606 -15.54694,15.54697zm51.68121,95.48602c0,3.21416 -2.59305,5.81516 -5.81569,5.81516c-3.22214,0 -5.82314,-2.601 -5.82314,-5.81516c0,-3.20564 2.60153,-5.82312 5.82314,-5.82312c3.22264,0 5.81569,2.61748 5.81569,5.82312zm24.5034,-98.57733c1.70067,0 3.09131,1.3901 3.09131,3.09131l0,85.38515l-66.81972,0l0,-85.38567c0,-1.70068 1.39006,-3.09131 3.09128,-3.09131l60.63713,0l0,0.00053z"
    />
    <rect stroke="null" id="svg_10" height="79.80943" width="47.45425" y="134.29791" x="201.43425" fill="#ffffff" />
    <path
      stroke="null"
      id="svg_11"
      fill="#452AB6"
      d="m242.51968,132.15225l-36.26402,0c-4.36758,0 -7.90831,3.54971 -7.90831,7.90883l0,68.68369c0,4.36761 3.54073,7.90935 7.90831,7.90935l36.26402,0c4.3591,0 7.9003,-3.54173 7.9003,-7.90935l0,-68.68369c0,-4.35912 -3.5412,-7.90883 -7.9003,-7.90883zm-0.40097,7.90883l0,61.2253l-35.51099,0l-0.35205,-60.82484l35.86304,-0.40045zm-21.68916,68.48c0,-2.16757 1.76608,-3.95067 3.95015,-3.95067c2.19205,0 3.95813,1.7831 3.95813,3.95067c0,2.18408 -1.76608,3.95868 -3.95813,3.95868c-2.18407,0 -3.95015,-1.7746 -3.95015,-3.95868z"
    />
  </g>
);

const NetworkTopology: React.FC<{ topologyData: TopologyData }> = ({ topologyData }) => {
  const { t } = useTranslation();

  const internetPosition = { x: 50, y: 90 };
  const routerPosition = { x: 200, y: 90 };
  const devicePosition = { x: 350, y: 40 };
  const robotPosition = { x: 350, y: 140 };

  const internetLineStyle = {
    stroke: topologyData.isConnectedToInternet ? '#008800' : 'grey',
    strokeDasharray: topologyData.isConnectedToInternet ? 'none' : '4,5',
    strokeWidth: 1.5,
    opacity: topologyData.isConnectedToInternet ? 1 : 0.5,
  };

  const lineStyle = {
    stroke: '#452AB6',
    strokeWidth: 1.5,
  };

  return (
    <div style={{ width: '100%', height: '100%', padding: '0.5rem' }}>
      <SVGContainer>
        <svg viewBox="0 0 450 200">
          {/* Conexiones */}
          <line
            x1={internetPosition.x}
            y1={internetPosition.y}
            x2={routerPosition.x}
            y2={routerPosition.y}
            style={internetLineStyle}
          />
          <line
            x1={routerPosition.x}
            y1={routerPosition.y}
            x2={devicePosition.x}
            y2={devicePosition.y}
            style={lineStyle}
          />

          <line
            key="line-internet-to-main"
            x1={routerPosition.x}
            y1={routerPosition.y}
            x2={robotPosition.x}
            y2={robotPosition.y}
            style={lineStyle}
          />

          {/* Círculos */}
          <CircleInternet
            key="internet"
            cx={internetPosition.x}
            cy={internetPosition.y}
            r="25"
            color={topologyData.isConnectedToInternet ? '#008800' : '#6b6b6b70'}
          />

          <Circle cx={routerPosition.x} cy={routerPosition.y} r="25" />
          <Circle cx={devicePosition.x} cy={devicePosition.y} r="25" />
          <Circle cx={robotPosition.x} cy={robotPosition.y} r="25" />

          {/* Icono de Internet */}
          <InternetIcon
            x={internetPosition.x}
            y={internetPosition.y}
            isConnected={topologyData.isConnectedToInternet}
          />
          <MangoIcon x={routerPosition.x} y={routerPosition.y} />
          <ThymioIcon x={robotPosition.x} y={robotPosition.y} />
          <DeviceIcon x={devicePosition.x} y={devicePosition.y} />

          <SVGNumberText x={robotPosition.x - 3} y={robotPosition.y + 20}>
            {topologyData.yourRouter.robots.length}
          </SVGNumberText>

          <SVGNumberText x={devicePosition.x - 3} y={devicePosition.y + 20}>
            {topologyData.yourRouter.devices.length}
          </SVGNumberText>

          <SVGText
            x={internetPosition.x - 12}
            y={internetPosition.y + 36}
            color={topologyData.isConnectedToInternet ? '#008800' : '#6b6b6b70'}
          >
            Internet
          </SVGText>

          <SVGText x={routerPosition.x - 16} y={routerPosition.y + 36}>
            Thymio2+
          </SVGText>

          <SVGText x={devicePosition.x - 25} y={devicePosition.y + 36}>
            {t('topology_active_device')}
          </SVGText>

          <SVGText x={robotPosition.x - 35} y={robotPosition.y + 36}>
            {t('topology_connected_robot')}
          </SVGText>
        </svg>
      </SVGContainer>
    </div>
  );
};

export default NetworkTopology;
